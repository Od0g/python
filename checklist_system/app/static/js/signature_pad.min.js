document.addEventListener('DOMContentLoaded', function () {
    // Para a tela de preenchimento do colaborador
    const canvasColab = document.getElementById('signature-pad-colab');
    if (canvasColab) {
        const signaturePadColab = new SignaturePad(canvasColab);
        const clearButtonColab = document.getElementById('clear-colab');
        const checklistForm = document.getElementById('checklistForm');
        const hiddenSignatureColab = document.getElementById('assinatura_colaborador');
        const hiddenRespostas = document.getElementById('respostas');

        clearButtonColab.addEventListener('click', function () {
            signaturePadColab.clear();
        });

        checklistForm.addEventListener('submit', function (event) {
            if (signaturePadColab.isEmpty()) {
                alert("Por favor, forneça sua assinatura.");
                event.preventDefault();
                return;
            }

            // Coletar respostas
            const perguntas = document.querySelectorAll('.pergunta-item');
            const respostasArray = [];
            perguntas.forEach(p => {
                const perguntaTexto = p.querySelector('label').innerText;
                const respostaValor = p.querySelector('input[type=radio]:checked');
                if (!respostaValor) {
                     alert("Por favor, responda todas as perguntas.");
                     event.preventDefault();
                     return;
                }
                respostasArray.push({
                    pergunta: perguntaTexto,
                    resposta: respostaValor.value
                });
            });

            // Preencher campos ocultos
            hiddenSignatureColab.value = signaturePadColab.toDataURL('image/png');
            hiddenRespostas.value = JSON.stringify(respostasArray);
        });
    }

    // Para a tela de validação do gestor
    const canvasGestor = document.getElementById('signature-pad-gestor');
    if (canvasGestor) {
        const signaturePadGestor = new SignaturePad(canvasGestor);
        const clearButtonGestor = document.getElementById('clear-gestor');
        const validationForm = document.getElementById('validationForm');
        const hiddenSignatureGestor = document.getElementById('assinatura_gestor');

        clearButtonGestor.addEventListener('click', function () {
            signaturePadGestor.clear();
        });

        validationForm.addEventListener('submit', function(event) {
             if (signaturePadGestor.isEmpty()) {
                alert("Por favor, forneça sua assinatura para validar.");
                event.preventDefault();
                return;
            }
            hiddenSignatureGestor.value = signaturePadGestor.toDataURL('image/png');
        });
    }
});