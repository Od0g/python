{% extends "layouts/base.html" %}

{% block title %}Relatórios{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2>Relatórios do Sistema</h2>
    <hr>
    
    <form class="mb-4" method="GET" action="{{ url_for('admin.gerar_relatorios') }}">
        <div class="row">
            <div class="col-md-3">
                <label for="colaborador_id">Colaborador</label>
                <select class="form-control" id="colaborador_id" name="colaborador_id">
                    <option value="">Todos</option>
                    {% for col in colaboradores %}
                        <option value="{{ col.id }}">{{ col.nome }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label for="setor_id">Setor</label>
                <select class="form-control" id="setor_id" name="setor_id">
                    <option value="">Todos</option>
                    {% for setor in setores %}
                        <option value="{{ setor.id }}">{{ setor.nome }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <label for="data_inicio">Data Início</label>
                <input type="date" class="form-control" id="data_inicio" name="data_inicio">
            </div>
            <div class="col-md-3">
                <label for="data_fim">Data Fim</label>
                <input type="date" class="form-control" id="data_fim" name="data_fim">
            </div>
        </div>
        <button type="submit" class="btn btn-primary mt-3">Filtrar</button>
    </form>
    
    <div class="mb-4">
        <a href="{{ url_for('admin.exportar_relatorio', formato='csv', **request.args) }}" class="btn btn-success">Exportar para CSV</a>
        </div>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Colaborador</th>
                <th>Setor</th>
                <th>Tipo</th>
                <th>Data</th>
                <th>Pontuação</th>
                <th>Situação</th>
            </tr>
        </thead>
        <tbody>
            {% for res in resultados %}
            <tr>
                <td>{{ res.colaborador.nome }}</td>
                <td>{{ res.colaborador.setor.nome }}</td>
                <td>{{ res.modelo.tipo }}</td>
                <td>{{ res.data_preenchimento.strftime('%d/%m/%Y') }}</td>
                <td>{{ res.pontuacao_final }}</td>
                <td>{{ res.situacao }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" class="text-center">Nenhum resultado encontrado.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}